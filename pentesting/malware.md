# Introduction To Malware

By: Nick Bulischeck, Foster McLane, Mackenzie Binns

CU Cyber


## You Can Find These Presentations Online

Visit [cucyber.net](https://cucyber.net/) to find these presentations and more online!



# Types


## Rootkits

* rings
* chkrootkit
* DLL Injection (DYLIB for the Mac people)


## RAT

* remote administration tool
* typically accompanied by a rootkit
* DarkComet + PoisonIvy


## Ransomware

* encryption routine
	- AES256, RSA 2048, SHA512, ChaCha20, etc.
* typically has a server component
* CryptoWall


## Worms

* self-propagating
* Stuxnet
* Mirai


## Trojans

* backdoors
* office macros
* FinFisher (Lench/Gamma), Galileo RCS (HT)


## Virus

* spreads by hand
* polymorphic
* deleting files, crashing OS, corrupting files, etc.



# Languages


## Shellcoding

* a set of instructions that are injected by the user and executed by the exploited binary
* x86 Assembly GAS/AT&T vs Intel


## C

* ransomware
* rootkits
* pretty much anything
* not web stuff


## Java

* mobile
* IoT (TVs, fridges)


## Python

* web
* reverse shells



# Fun Time


## Clone Me

```sh
git clone https://github.com/nbulischeck/temp.git
```


## Shellcoding


### Writing The Assembly

#### first.asm

```asm
global _start
_start:
        push 60
		pop rax
        xor rdi,rdi
		syscall
```


### Getting The Shellcode

```sh
objdump -d ./PROGRAM |grep '[0-9a-f]:'|grep -v 'file' | \
cut -f2 -d:|cut -f1-6 -d' '|tr -s ' '|tr '\t' ' ' | \
sed 's/ $//g'|sed 's/ /\\x/g'|paste -d '' -s | \
sed 's/^/"/'|sed 's/$/"/g'
```


### ...Or Just Use What I Wrote

```sh
./getshellcode.py first
```


### Get This

```
\x6a\x3c\x58\x31\xdb\x0f\x05
```


### Run Shellcode

#### codetest.c

```c
const char code[] = "bytecode will go here!";
int main(int argc, char **argv){
  int (*func)();
  func = (int (*)()) code;
  (int)(*func)();
}
```


### Spawning a Shell in C

#### shell.c

```c
#include <stdlib.h>
#include <unistd.h>

int main(){

	char *shell[2];
	shell[0] = "/bin/sh";
	shell[1] = NULL;
	execve(shell[0], shell, NULL);
	exit(0);

}
```


### Spawning a Shell in Assembly

#### shell.asm

```asm
section .text
   global _start
shell:
	pop rdi

	push 59
	pop rax

	xor rsi, rsi
	xor rdx, rdx

	syscall

_start:
	call shell
	db '/bin/sh'
```



## Dirty CoW

* "dirty" copy-on-write, race condition, private read-only memory mappings
* privilege escalation
* works on RHEL7 Linux  x86\_64, Debian 7 ("wheezy")
* Ubuntu 14.04.5 LTS, Ubuntu 16.04.1 LTS, Ubuntu 16.10
* Linux Mint 17.2


### Changing passwords

* `mkpasswd -m sha-512`
* alter genpasswd.py (Python 3.3 vs. others)


### Running

* `./dcow`
* If you won the race, congratulations on root!



## Keylogger

* `sudo ./keylogger`
* do not background it
* /tmp/tmp54e3zO/tmp54e3z0.log


# Questions?
