# Intro To SQL Injection

By: Mackenzie Binns, Nick Bulischeck, and Max Harley

CU Cyber


## You Can Find These Presentations Online

Visit [cucyber.net](https://cucyber.net/) to find these presentations and more online!

<span style="padding-top: 6em; font-size: 0.4em; float: left;">Material: <a href="https://tldrlegal.com/license/creative-commons-attribution-sharealike-4.0-international-(cc-by-sa-4.0)">Creative Commons Attribution-ShareAlike 4.0</a></span><span style="padding-top: 6em; font-size: 0.4em; float: right;">Code: <a href="https://tldrlegal.com/license/bsd-2-clause-license-(freebsd)">BSD 2-Clause</a></span>



# SQL Injection

Where does this fit into penetration testing?

Note:
* Web vulnerability, so this type of attack should be a consideration when threat modeling


## What Is SQL Injection?

* SQL injection is a command injection technique used on web servers to run arbitrary SQL commands on a database

Note:
* This can be the way the database receives queries or how the string is sanitized


## Where Can You Find It?

* SQL injection vulnerabilities can be found on sites using
    - Login forms
    - Search bars
    - Anything where the user puts in input and the server returns something from a database


## What's Supposed to Happen

![ok_diagram](ok_diagram.jpg)


## What a Hacker Can Do

![inj_diagram](inj_diagram.jpg)


## Why Is It Useful?

* SQL injection is useful for a multitude of reasons, but most people use it for getting passwords
* SQL injection can be used for
    - Information gathering
    - Getting a foot hold on the server
    - Getting a Shell
    - Etc.

Note:
* By foothold I mean internal network access to computers that would other wise not be accessible
* Those types of computers are typically more vulnerable to attack due to some companies not having in depth defense



# SQL Commands


## User Table

|Id|Username|Password|
|:-:|:-:|:-:|
|1|admin|admin|
|2|user|test|
|3|hack|me|


## SELECT

* `SELECT * FROM users;`

|Id|Username|Password|
|:-:|:-:|:-:|
|1|admin|admin|
|2|user|test|
|3|hack|me|


## SELECT

* `SELECT Id FROM users;`

|Id|
|:-:|
|1|
|2|
|3|


## SELECT

* `SELECT Username, Password FROM users;`

|Username|Password|
|:-:|:-:|
|admin|admin|
|user|test|
|hack|me|


## SELECT

* `SELECT Password FROM users WHERE Username = 'admin';`

|Password|
|:-:|
|admin|


## UNION

* Combine two or more select statements
* `SELECT column_name(s) FROM table1 UNION SELECT column_name(s) FROM table2;`

Note:
How can this be used during a SQL injection?



# What is sqlmap


## Another Tool for the Toolbox

* sqlmap is an automated tool that will allow you to preform complicated SQL injections
* Useful for when you think something may be SQL injectable based on prior information gathering


## HTTP Request Types

* GET
    - Requests data from a specific source
    - Passes parameters as values in the URI

```http
GET /form/test_form.php?username=admin&password=password HTTP/1.1
Host: inserthosthere.com
```

* POST
    - Posts data to a specific source
    - Passes it as values in the body

```http
POST /test/demo_form.asp HTTP/1.1
Host: inserthosthere.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 31
username=value1&password=value2
```

Note:
* sqlmap handles these differently and you must determine what method the web server is using
* The parameters are what SQL injections target because that is what information is passed to the database


## Digging Into sqlmap Options

* `-u` - Host you are targeting
* `-a` - Tell sqlmap to grab everything back that it can, highly intrusive
* `-b` - Tell sqlmap to just prove that the site is injectable, low intrusion
* `--passwords` - Tell sqlmap to enumerate the database for password hashes and users
* `--tables` - Tell sqlmap to find table names
* `--columns` - Tell sqlmap to enumerate columns in a table
* `-D` - Database to enumerate
* `-C` - Columns to retrieve


## Using Firefox to Your Advantage

* Developer options can show network traffic between you an your host
* You can use this to craft your own requests or pull information back from a website


## Using sqlmap

* Demo using DVWA
